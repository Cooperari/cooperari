#! /bin/bash

if [ $# -ne 2 ]; then
  echo "Usage: cjunit data_dir test_class"
  exit 1
fi

source $(dirname $0)/cclasspath
data_dir=$1
test_class=$2

echo Configuring instrumentation ...
$(dirname $0)/cinstr $data_dir $test_class

if [ $? -ne 0 ]; then
  exit 1
fi

CONFIG_CLASSPATH="$data_dir/$test_class-cooperari.jar"
CLASSPATH="$CONFIG_CLASSPATH:$COOPERARI_CLASSPATH:$data_dir/classes"
echo $CLASSPATH
echo $ASPECTJ_AGENT_JAR
java -classpath "$CLASSPATH" \
   "-javaagent:$ASPECTJ_AGENT_JAR" \
   "-Daj.class.path=$CLASSPATH" \
   org.cooperari.tools.cjunit.Main \
   $test_class
